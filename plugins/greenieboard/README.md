# Plugin Greenieboard
This plugin allows you to have a (optional: persistent) greenieboard for the top x (default: 10) players and to give 
players the opportunity to analyse their last carrier landings.

**__Attention:__**<br/> 
- The landing quality marks will only be generated for landings\* on the DCS Super Carrier module unless you use MOOSE 
- AIRBOSS (see below).</br>
- MISSION_STATISTICS = true has to be enabled for your server.**
<p></p>
*Not all landings generate a mark for whatever reason and some are off from what you might have experienced in game.

## Moose AIRBOSS Integration (Optional)
You can now integrate your LSO comments and trapsheets generated by Moose AIRBOSS into DCSServerBot!<br>
To do so, follow the configuration example below. DCSServerBot will detect your landings and generate the needed 
information for players, so that you can checkout your landings with the .carrier command.<br>
The included trapsheet graphs are taken from HypeMan, so credits go to Rob <3!<br>
<br>
I can't do a full Moose AIRBOSS documentation here, you guys want to look at this 
[link](https://flightcontrol-master.github.io/MOOSE_DOCS_DEVELOP/Documentation/Ops.Airboss.html) instead. To use the
full capabilities of DCSServerBot, I would expect that you save Trapsheet data in addition to the normal LSO comments.
Both are being stored in CSV files, usually somewhere below your Saved Games\<instance>\ folder. You need to configure
this folder and the format of your files in the greenieboard.json, see the example below. 
**I would recommend to use separate files per carrier.**<br>

### Code Changes
To integrate DCSServerBot into your lua code using Moose AIRBOSS, you need to send the following structure to the bot
**after** the trapsheet is written to disk:
```lua
local airboss=AIRBOSS:New("CVN-73", "CVN-73")

function airboss:OnAfterLSOGrade(from, event, to, playerData, myGrade)
    player_name = playerData.name:gsub('[%p]', '')
    [...] -- do some magic in here, like SH break, etc.
    airbossWashington:SetTrapSheet(nil, "AIRBOSS-trapsheet-" .. player_name)
    [...]
    self:_SaveTrapSheet(playerData, myGrade)

    msg = {}
    msg.command = "onMissionEvent"
    msg.eventName = "S_EVENT_AIRBOSS"
    msg.initiator = {}
    msg.initiator.name = playerData.name
    msg.place = {}
    msg.place.name = myGrade.carriername
    msg.points = myGrade.points
    msg.time = timer.getAbsTime()
    dcsbot.sendBotTable(msg)
end 
```
A sample file is included in plugins/greenieboard/sample/airboss.lua

## Configuration
Greenieboard comes as many other plugins with a JSON configuration. If you don't generate your own config, DCSServerBot
will just copy over the sample by itself and use that one. This will do it for the most users, if you don't plan to
use the persistent mode.

Anyway, this is how the configuration will look like. For now, there is only a default config, so you can't generate
different greenieboards for different servers. If that is a user demand in the future, I might add it.

```json
{
  "configs": [
    {
      "num_landings": 5,            -- the number of latest carrier landings you get, if you use the .carrier command
      "num_rows": 10,               -- the number of players that can get on the greenieboard (there might be discord limits)
      "persistent_board": true,     -- true (default false) if you want a persistent board displayed somewhere in your discord
      "persistent_channel": "1234", -- the ID of the channel where the greenieboard should be displayed
      "ratings": {                  -- ratings will define how many points you get for which LSO rating (see SC documentation for details)
        "_OK_": 5,                  -- if using Moose.AIRBOSS, ratings will be taken from there!
        "OK": 4,
        "(OK)": 3,
        "B": 2.5,
        "---": 2,
        "OWO": 2,
        "WO": 1,
        "C": 0
      }
    },
    -- OPTIONAL MOOSE AIRBOSS INTEGRATION --
    {
      "installation": "DCS.openbeta_server",
      "Moose.AIRBOSS": {
        "basedir": "airboss",
        "grades": "AIRBOSS-{carrier}_LSOGrades.csv",
        "trapsheets": "*AIRBOSS-{carrier}_Trapsheet-{name}_{unit_type}*.csv"
      }
    }
  ]
}
```

## Discord Commands

| Command         | Parameter          | Channel       | Role      | Description                                                                       |
|-----------------|--------------------|---------------|-----------|-----------------------------------------------------------------------------------|
| .greenieboard   |                    | all           | DCS       | Print the current greenieboard.                                                   |
| .carrier        | @member / DCS name | all           | DCS       | Display the last carrier landings for this user and a detailed view on selecion.  |
