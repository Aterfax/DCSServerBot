INSERT INTO plugins (plugin, version) VALUES ('greenieboard', 'v1.0') ON CONFLICT (plugin) DO NOTHING;
CREATE TABLE IF NOT EXISTS greenieboard (id SERIAL PRIMARY KEY, player_ucid TEXT NOT NULL, unit_type TEXT NOT NULL, grade TEXT NOT NULL, comment TEXT NOT NULL, place TEXT NOT NULL, night BOOLEAN NOT NULL, points DECIMAL, time TIMESTAMP NOT NULL DEFAULT NOW());
CREATE INDEX IF NOT EXISTS idx_greenieboard_ucid ON greenieboard(player_ucid);
INSERT INTO greenieboard (player_ucid, unit_type, grade, comment, place, night, points, time) SELECT init_id, init_type, grade, comment, place, FALSE, CASE WHEN grade = '_OK_' THEN 5 WHEN grade = 'OK' THEN 4 WHEN grade = '(OK)' THEN 3 WHEN grade = 'B' THEN 2.5 WHEN grade = '---' THEN 2 WHEN grade = 'OWO' THEN 2 WHEN grade = 'WO' THEN 1 WHEN grade = 'C' THEN 0 END AS points, time FROM (SELECT init_id, init_type, SUBSTRING(comment, 'LSO: GRADE:([_\(\)-BCKOW]{1,3})') AS grade, comment, place, time FROM  missionstats WHERE event LIKE '%QUALITY%') AS landings;
